<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mullo</title>
<style>
body { margin:0; overflow:hidden; font-family:sans-serif; background:#222; color:white; }
canvas { display:block; background:#222; }
#status { position:absolute; top:10px; left:10px; font-weight:bold; }
#usernameContainer { position:absolute; top:10px; right:10px; }
#usernameContainer input, #usernameContainer button { margin:2px; padding:5px; }
</style>
</head>
<body>

<div id="status">OFFLINE</div>
<div id="usernameContainer">
<input id="usernameInput" placeholder="Enter username" />
<button id="setUsernameBtn">Set Username</button>
</div>
<canvas id="gameCanvas"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const statusDiv = document.getElementById("status");
const usernameInput = document.getElementById("usernameInput");
const setUsernameBtn = document.getElementById("setUsernameBtn");

const socket = io(); // connect to server

let localId;
let players = {};

// Handle connection
socket.on("connect", () => {
    localId = socket.id;
    statusDiv.textContent = "ONLINE";
    statusDiv.style.color = "lime";
});

socket.on("disconnect", () => {
    statusDiv.textContent = "OFFLINE";
    statusDiv.style.color = "red";
});

// Update all players
socket.on("playersUpdate", data => {
    players = data;
});

// Movement
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

const speed = 5;
function movePlayer() {
    if(!localId) return;
    let dx = 0, dy = 0;
    if(keys["ArrowUp"]||keys["w"]) dy -= speed;
    if(keys["ArrowDown"]||keys["s"]) dy += speed;
    if(keys["ArrowLeft"]||keys["a"]) dx -= speed;
    if(keys["ArrowRight"]||keys["d"]) dx += speed;
    if(dx!==0 || dy!==0) socket.emit("move", {dx, dy});
}

// Set username
setUsernameBtn.onclick = () => {
    const name = usernameInput.value.trim();
    if(name) socket.emit("setUsername", name);
};

// Draw players
function drawPlayers() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(let id in players){
        const p = players[id];
        ctx.fillStyle = p.color || "#"+Math.floor(Math.random()*16777215).toString(16);
        ctx.beginPath();
        ctx.arc(p.x, p.y, 20, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.textAlign = "center";
        ctx.fillText(p.username || id, p.x, p.y-30);
    }
}

function gameLoop(){
    movePlayer();
    drawPlayers();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
