<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mullo LAN</title>
<style>
body{margin:0;overflow:hidden;background:#222;color:white;font-family:sans-serif}
canvas{display:block;background:#222}
#ui{position:absolute;top:10px;left:10px;color:white;font-family:sans-serif}
button,input{font-size:16px;margin:5px;padding:5px}
</style>
</head>
<body>
<div id="ui">
<span id="status">OFFLINE</span><br>
<span id="deviceCode"></span><br>
<input id="joinCode" placeholder="Enter 5-digit code"/>
<button id="joinBtn">Join</button>
</div>
<canvas id="gameCanvas"></canvas>

<script>
// --- Setup Canvas ---
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- Game Data ---
let players = {};
let localId = Math.random().toString(36).substring(2,6);
players[localId] = {x:Math.random()*500,y:Math.random()*500,color:getRandomColor()};

// --- Device Code UI ---
const statusEl = document.getElementById("status");
const deviceCodeEl = document.getElementById("deviceCode");
deviceCodeEl.innerText = `Your device code: ${localId}`;
statusEl.innerText = "ONLINE";

// --- Join Button ---
document.getElementById("joinBtn").onclick = () => {
    const code = document.getElementById("joinCode").value.trim();
    if(code && code !== localId){
        // Spawn a new player
        players[code] = {x:Math.random()*500,y:Math.random()*500,color:getRandomColor()};
    }
};

// --- Movement ---
const keys = {};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);
const speed = 5;

// --- Draw Loop ---
function drawPlayers(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let id in players){
        const p = players[id];
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x,p.y,20,0,Math.PI*2);
        ctx.fill();
        ctx.fillStyle="white";
        ctx.font="16px Arial";
        ctx.textAlign="center";
        ctx.fillText(id,p.x,p.y-30);
    }
}

function movePlayer(){
    const p = players[localId];
    if(!p) return;
    if(keys["ArrowUp"]||keys["w"]) p.y -= speed;
    if(keys["ArrowDown"]||keys["s"]) p.y += speed;
    if(keys["ArrowLeft"]||keys["a"]) p.x -= speed;
    if(keys["ArrowRight"]||keys["d"]) p.x += speed;
}

function gameLoop(){
    movePlayer();
    drawPlayers();
    requestAnimationFrame(gameLoop);
}

gameLoop();

// --- Random Color ---
function getRandomColor(){
    const letters="0123456789ABCDEF";
    let color="#";
    for(let i=0;i<6;i++) color+=letters[Math.floor(Math.random()*16)];
    return color;
}
</script>
</body>
</html>
